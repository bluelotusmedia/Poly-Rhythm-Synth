
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Web Synthesizer</title>
    <style>
      :root {
        --background-color: #191924;
        --surface-color: #242436;
        --surface-color-light: #3a3a50;
        --primary-color: #a45ee5;
        --secondary-color: #00f5d4;
        --on-surface-color: #e8e8e8;
        --on-primary-color: #111;
        --disabled-color: #555;
        --knob-size: 40px;
        --danger-color: #ff6b6b;
      }
      body {
        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto,
          Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
        background-color: var(--background-color);
        color: var(--on-surface-color);
        margin: 0;
        padding: 0;
        display: flex;
        justify-content: center;
        align-items: flex-start;
        min-height: 100vh;
        -webkit-font-smoothing: antialiased;
        -moz-osx-smoothing: grayscale;
      }
      #root {
        width: 100%;
        padding: 1rem 2rem 2rem 2rem;
        box-sizing: border-box;
      }
      .app-container {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
        max-width: 1200px;
        margin: 0 auto;
      }
      
      .top-bar {
        background-color: var(--surface-color);
        border-radius: 8px;
        padding: 1rem 1.5rem;
        border: 1px solid var(--surface-color-light);
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        flex-wrap: wrap;
      }
      .top-bar-group {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
       .top-bar-group h2 {
        margin: 0;
        font-size: 1.2rem;
        color: var(--on-surface-color);
        font-weight: 500;
       }
      .panic-button {
        background-color: var(--danger-color);
        color: white;
        font-weight: bold;
      }
      .panic-button:hover {
        background-color: #ff8c8c;
      }

      .main-grid {
        display: flex;
        flex-direction: column;
        gap: 1.5rem;
      }
      .full-width-container {
        width: 100%;
      }
      .master-visualizer-container {
        background-color: var(--surface-color);
        border-radius: 8px;
        padding: 0.5rem;
        border: 1px solid var(--surface-color-light);
        height: 150px; /* Adjusted height */
        display: flex;
        flex-direction: column;
        gap: 0.25rem;
      }
       .visualizer-wrapper {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex: 1;
        min-height: 0; 
      }
      .visualizer-label {
        font-size: 0.8rem;
        font-weight: bold;
        color: var(--secondary-color);
        writing-mode: vertical-rl;
        text-orientation: mixed;
      }
      .channels-container {
        display: grid;
        grid-template-columns: repeat(auto-fit, minmax(340px, 1fr));
        gap: 1.5rem;
      }

      .processing-container {
        display: grid;
        grid-template-columns: 2fr 3fr;
        gap: 1.5rem;
        min-width: 0;
      }

       .filters-container { 
          display: flex;
          flex-direction: column;
          gap: 1rem;
       }
       .filters-container-header {
          display: flex;
          justify-content: space-between;
          align-items: center;
          padding: 0 0.5rem;
          background-color: var(--surface-color);
          border: 1px solid var(--surface-color-light);
          border-bottom: none;
          padding: 1rem 1.5rem;
          border-top-left-radius: 8px;
          border-top-right-radius: 8px;
       }
        .filters-container-header h2 {
            margin: 0;
            font-size: 1.2rem;
            color: var(--on-surface-color);
            font-weight: 500;
        }
       .filters-grid {
          display: grid;
          grid-template-columns: 1fr 1fr;
          gap: 1.5rem;
          background-color: var(--surface-color);
          border: 1px solid var(--surface-color-light);
          border-top: none;
          padding: 0 1.5rem 1.5rem 1.5rem;
          border-bottom-left-radius: 8px;
          border-bottom-right-radius: 8px;
       }
       .bottom-module-container {
          background-color: var(--surface-color);
          border-radius: 8px;
          padding: 1.5rem;
          border: 1px solid var(--surface-color-light);
       }
       .lfo-grid-container {
          display: grid;
          grid-template-columns: 1fr 1fr 1fr;
          gap: 1.5rem;
       }
        .main-control-panel { 
          background-color: var(--surface-color);
          border: 1px solid var(--surface-color-light);
          border-radius: 8px;
          padding: 1rem 1.5rem;
          display: flex; 
          flex-wrap: wrap;
          justify-content: space-between;
          align-items: center;
          gap: 1.5rem;
        }
        .main-control-panel .sub-control-group {
            display: flex;
            align-items: center;
            gap: 1rem;
            border-left: 1px solid var(--surface-color-light);
            padding-left: 1.5rem;
        }
        .main-control-panel .sub-control-group:first-child {
            border-left: none;
            padding-left: 0;
        }
         .main-control-panel .sub-control-group h2 {
            margin: 0 1rem 0 0;
            font-size: 1.2rem;
            color: var(--on-surface-color);
            font-weight: 500;
            white-space: nowrap;
        }
        .main-control-panel .control-row {
          margin-bottom: 0;
        }
        .main-control-panel label {
          white-space: nowrap;
        }
        .main-control-panel .randomizer-buttons-group {
          padding-left: 0.5rem;
        }


      .control-group {
        background-color: var(--surface-color);
        border-radius: 8px;
        padding: 1.5rem;
        border: 1px solid var(--surface-color-light);
        display: flex;
        flex-direction: column;
      }
      .lfo-controls {
        padding: 0;
        background: none;
        border: none;
        box-shadow: none;
      }
      .control-group-header {
        display: flex;
        flex-direction: column;
        align-items: stretch;
        border-bottom: 1px solid var(--secondary-color);
        padding-bottom: 1rem;
        margin-bottom: 1rem;
        gap: 1rem;
      }
      .engine-header-top-bar {
        display: flex;
        justify-content: space-between;
        align-items: center;
      }
      .control-group-header h2 {
        margin: 0;
        color: var(--on-surface-color);
        font-size: 1.2rem;
        font-weight: 500;
      }
      
      .control-row {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 0.85rem;
        min-height: 30px;
        gap: 1rem;
        flex-wrap: wrap;
      }
      label {
        font-size: 0.9rem;
        color: #b0b0c0;
      }
      input[type="range"] {
        -webkit-appearance: none; appearance: none;
        width: 150px; height: 6px;
        border-radius: 3px;
        background: var(--background-color);
        outline: none;
        transition: opacity 0.2s;
      }
      input[type="range"]:disabled {
        opacity: 0.5;
      }
      input[type="range"]::-webkit-slider-thumb {
        -webkit-appearance: none; appearance: none;
        width: 20px; height: 20px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        border: 3px solid var(--surface-color);
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
      }
       input[type="range"]::-moz-range-thumb {
        width: 20px; height: 20px;
        border-radius: 50%;
        background: var(--primary-color);
        cursor: pointer;
        border: 3px solid var(--surface-color);
        box-shadow: 0 0 5px rgba(0,0,0,0.5);
      }
      button {
        background-color: var(--primary-color);
        color: var(--on-surface-color);
        border: none;
        padding: 0.5rem 1rem;
        border-radius: 4px;
        cursor: pointer;
        font-weight: bold;
        transition: background-color 0.2s;
      }
      button:hover {
        filter: brightness(1.2);
      }
      button:disabled {
        background-color: var(--disabled-color);
        color: #888;
        cursor: not-allowed;
      }
      button.active {
        background-color: var(--secondary-color);
        color: var(--on-primary-color);
      }
       button.small {
        padding: 0.3rem 0.6rem;
        font-size: 0.8rem;
      }
      select {
        background-color: var(--surface-color-light);
        color: var(--on-surface-color);
        border: 1px solid var(--primary-color);
        border-radius: 4px;
        padding: 0.4rem;
        max-width: 180px;
      }
       .init-overlay {
        position: fixed; top: 0; left: 0;
        width: 100%; height: 100%;
        background: rgba(0,0,0,0.8);
        display: flex; justify-content: center; align-items: center;
        z-index: 1000;
      }
       .init-overlay button { font-size: 1.5rem; padding: 1rem 2rem; }
       .visualizer {
        width: 100%;
        height: 100%;
        border-radius: 4px;
        background-color: #111;
      }
      .channel-visualizer-container {
        height: 200px;
        width: 200px;
        flex-shrink: 0;
        border-radius: 50%;
        border: 2px solid var(--surface-color-light);
        overflow: hidden;
        margin: 0.5rem auto 0 auto;
      }
      .drop-zone {
        border: 2px dashed var(--disabled-color);
        border-radius: 4px;
        padding: 1rem; text-align: center;
        color: #888;
        transition: border-color 0.2s, background-color 0.2s;
        margin-bottom: 1rem;
      }
      .drop-zone-active {
        border-color: var(--secondary-color);
        background-color: rgba(0, 245, 212, 0.1);
      }
      .sampler-info {
        display: flex;
        justify-content: center;
        align-items: center;
        flex-direction: column;
        gap: 0.5rem;
      }
      .replace-sample-text { display: block; font-size: 0.8rem; color: #888; margin-top: 0.25rem; }
      .sampler-actions {
        display: flex;
        gap: 0.5rem;
        justify-content: center;
        margin-top: 1rem;
        width: 100%;
      }
      .control-value-wrapper {
        display: flex;
        align-items: center;
        gap: 0.75rem;
      }
      .control-value-wrapper span {
        min-width: 65px;
        text-align: right;
        font-family: 'SF Mono', 'Courier New', Courier, monospace;
        color: var(--secondary-color);
        font-size: 0.9rem;
      }

      /* Engine Tab Layout Styles */
      .tab-nav {
        display: flex;
        border-bottom: 1px solid var(--surface-color-light);
        margin-bottom: 1rem;
      }
      .tab-button-wrapper {
        display: flex;
        align-items: center;
        background: none;
        border: none;
        color: #888;
        padding: 0.5rem 1rem;
        cursor: pointer;
        border-bottom: 2px solid transparent;
        transition: color 0.2s, border-color 0.2s, background-color 0.2s;
        font-size: 1rem;
        font-weight: 500;
        border-top-left-radius: 4px;
        border-top-right-radius: 4px;
      }
      .tab-button-wrapper:hover {
        color: var(--on-surface-color);
        background-color: var(--surface-color-light);
      }
      .tab-button-wrapper.active {
        background-color: var(--secondary-color);
        color: var(--on-primary-color);
        border-bottom-color: transparent;
      }
      .tab-button-label { flex-grow: 1; text-align: left; }
      .tab-power-button {
        width: 18px; height: 18px;
        border-radius: 50%;
        border: 2px solid var(--disabled-color);
        background-color: transparent;
        margin-left: 0.75rem; padding: 0;
        cursor: pointer;
        transition: background-color 0.2s, border-color 0.2s;
      }
      .tab-power-button:hover { border-color: var(--on-surface-color); }
      .tab-power-button.active {
        background-color: var(--secondary-color);
        border-color: var(--secondary-color);
      }
      .tab-button-wrapper.active .tab-power-button {
        border-color: #555; /* High contrast border when OFF */
      }
       .tab-button-wrapper.active .tab-power-button:hover {
        border-color: #111;
       }
      .tab-button-wrapper.active .tab-power-button.active {
        background-color: #fff; /* High contrast fill when ON */
        border-color: #fff;
      }
      
      .adsr-container {
        border-top: 1px solid var(--surface-color-light);
        margin-top: 1rem;
        padding-top: 1rem;
      }
      .adsr-container h4 {
        margin: 0 0 1rem 0;
        font-weight: 500;
        color: #b0b0c0;
      }

      /* Master Effects Styles */
      .master-effects-container {
        display: flex;
        flex-direction: column;
        min-width: 0; /* CRITICAL FIX for grid + overflow */
      }
      .effects-chain {
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        padding: 1rem;
        min-height: 150px;
        background-color: var(--background-color);
        border-radius: 6px;
        align-items: stretch;
        flex-grow: 1;
      }
      .effects-chain-empty {
        width: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        border: 2px dashed var(--surface-color-light);
        color: var(--disabled-color);
        font-style: italic;
        flex-grow: 1;
        min-height: 100px;
        border-radius: 4px;
      }
      .effect-module {
        background-color: var(--surface-color-light);
        border-radius: 6px;
        border: 1px solid #4a4a60;
        display: flex;
        flex-direction: column;
        flex-shrink: 0;
        transition: box-shadow 0.2s, border-color 0.2s;
      }
      .effect-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        cursor: grab;
        padding: 0.75rem;
      }
       .effect-header:active {
        cursor: grabbing;
      }
      .effect-header-title-group {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        font-weight: 500;
        pointer-events: none; /* Allow click to pass through to header */
      }
      .effect-header h3 {
        margin: 0;
        font-size: 1rem;
      }
      .effect-controls {
        padding: 0 0.75rem 0.75rem 0.75rem;
        display: flex;
        flex-direction: column;
        gap: 0.75rem;
        border-top: 1px solid var(--disabled-color);
        margin-top: 0.5rem;
        padding-top: 0.75rem;
      }
      .effect-header-buttons { display: flex; gap: 0.5rem; align-items: center; }
      
       .remove-effect-btn {
        background-color: #5e2a3a;
        color: #ff9999;
       }
       .remove-effect-btn:hover { background-color: #8b3e56; }
      
      /* Icon Buttons */
      .randomizer-buttons-group {
        display: flex;
        gap: 0.5rem;
      }
      .icon-button {
          background: none;
          border: 1px solid var(--surface-color-light);
          color: #b0b0c0;
          padding: 0.5rem;
          cursor: pointer;
          border-radius: 4px;
          transition: all 0.2s;
          display: flex;
          justify-content: center;
          align-items: center;
          width: 32px;
          height: 32px;
      }
      .icon-button:hover {
          background-color: var(--surface-color-light);
          border-color: var(--secondary-color);
          color: var(--secondary-color);
      }
      .icon-button.init-button {
        color: #888;
      }
      .icon-button.init-button:hover {
        color: var(--primary-color);
        border-color: var(--primary-color);
      }
      .icon-button svg {
          width: 20px;
          height: 20px;
          fill: currentColor;
      }
      .control-with-lock {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        width: 100%;
      }
      .lock-icon {
          background: none;
          border: none;
          color: #888;
          cursor: pointer;
          padding: 0;
          margin-left: 0.5rem;
      }
      .lock-icon.locked {
          color: var(--secondary-color);
      }
      .lock-icon svg {
          width: 16px;
          height: 16px;
          fill: currentColor;
      }
      
      /* New Bottom Tab Styles */
      .bottom-module-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        margin-bottom: 1rem;
        padding-bottom: 1rem;
        border-bottom: 1px solid var(--surface-color-light);
      }
      .bottom-tab-nav {
         display: flex;
      }
       .bottom-tab-button {
         background: none; border: none;
         color: #888;
         padding: 0.75rem 1rem;
         cursor: pointer;
         border-bottom: 2px solid transparent;
         transition: all 0.2s;
         font-size: 1rem; font-weight: 500;
         border-top-left-radius: 4px;
         border-top-right-radius: 4px;
       }
       .bottom-tab-button:hover {
         color: var(--on-surface-color);
         background-color: var(--surface-color-light);
       }
       .bottom-tab-button.active {
         background-color: var(--secondary-color);
         color: var(--on-primary-color);
         border-bottom-color: transparent;
       }
      
      /* Routing Matrix Styles */
      .routing-matrix {
        width: 100%;
        border-collapse: collapse;
        margin-top: 1rem;
      }
      .routing-matrix th, .routing-matrix td {
        padding: 0.75rem;
        text-align: center;
        border: 1px solid var(--surface-color-light);
      }
      .routing-matrix th {
        color: var(--secondary-color);
        font-weight: 500;
      }
      .routing-matrix td:first-child {
        text-align: left;
        color: var(--on-surface-color);
        font-weight: 500;
        font-size: 0.9rem;
      }
      .routing-matrix th.rotated-header {
        height: 140px;
        white-space: nowrap;
      }
      .routing-matrix th.rotated-header > div {
        transform: translate(25px, 51px) rotate(-45deg);
        width: 30px;
      }
      
      /* Filter Routing Switch */
      .filter-routing-switch {
        display: flex;
        background-color: var(--surface-color-light);
        border-radius: 6px;
        padding: 4px;
      }
      .filter-routing-switch button {
        background: none;
        border: none;
        color: #888;
        padding: 0.3rem 0.8rem;
        font-size: 0.8rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
        border-radius: 4px;
      }
      .filter-routing-switch button.active {
        background-color: var(--primary-color);
        color: var(--on-surface-color);
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      }

      .lfo-visualizer-container {
        width: 100%;
        height: 50px;
        background-color: var(--background-color);
        border-radius: 4px;
        margin-bottom: 1rem;
      }
      
      /* MIDI Styles */
      .midi-indicator {
          width: 12px;
          height: 12px;
          border-radius: 50%;
          background-color: #333;
          border: 1px solid #555;
          transition: background-color 0.05s;
          margin-right: -0.75rem;
      }
      
      .engine-title-group {
          display: flex;
          align-items: center;
          gap: 1rem;
      }
       .midi-toggle {
          background-color: var(--surface-color-light);
          color: var(--on-surface-color);
          border: 1px solid var(--disabled-color);
      }
      .midi-toggle.active {
          border-color: var(--secondary-color);
      }
      .seq-toggle {
          background-color: var(--surface-color-light);
          color: var(--on-surface-color);
          border: 1px solid var(--disabled-color);
      }
      .seq-toggle.active {
          border-color: var(--primary-color);
      }


      /* Voicing & Glide Styles */
      .voicing-switch {
        display: flex;
        background-color: var(--surface-color-light);
        border-radius: 6px;
        padding: 4px;
        height: fit-content;
      }
      .voicing-switch button {
        background: none;
        border: none;
        color: #aaa;
        padding: 0.3rem 0.8rem;
        font-size: 0.8rem;
        font-weight: bold;
        cursor: pointer;
        transition: all 0.2s;
        border-radius: 4px;
      }
      .voicing-switch button.active {
        background-color: var(--primary-color);
        color: var(--on-surface-color);
        box-shadow: 0 1px 3px rgba(0,0,0,0.3);
      }

      /* Graphic EQ Styles */
      .eq-container {
        display: flex;
        flex-direction: column;
        gap: 1rem;
      }
      .eq-band {
        display: flex;
        align-items: center;
        gap: 1rem;
      }
      .eq-band input[type="range"] {
        width: 100%;
        height: 6px;
      }
       .eq-band label {
         font-size: 0.7rem;
         font-family: 'SF Mono', 'Courier New', Courier, monospace;
         color: #888;
         min-width: 40px;
       }

    </style>
  <script type="importmap">
{
  "imports": {
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/",
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "@google/genai": "https://aistudiocdn.com/@google/genai@^1.29.0"
  }
}
</script>
<link rel="stylesheet" href="/index.css">
</head>
  <body>
    <div id="root"></div>
    <script type="module" src="/index.tsx"></script>
  </body>
</html>
